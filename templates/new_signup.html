<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - Trump-Verse</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Import Google fonts similar to Helvetica Neue -->
    <link href="https://fonts.googleapis.com/css2?family=Mulish:ital,wght@0,200..1000;1,200..1000&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="shortcut icon" href="{{ url_for('static', filename='images/ico.svg') }}" type="image/x-icon">

    <style>
        /* Global Styles */
        body {
            font-family: 'Mulish', sans-serif;
            margin: 0;
            background: linear-gradient(to bottom right, rgba(255, 0, 0, 0.6), rgba(0, 0, 255, 0.6)), url('{{ url_for('static', filename='images/background.jpg') }}') no-repeat center center/cover;
            background-size: cover;
            backdrop-filter: blur(10px);
            overflow-x: hidden; /* Avoid horizontal scrolling */
        }

        /* Navbar Styles */
        .navbar {
            width: 100%;
            position: fixed;
            top: 0;
            left: 0;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            border-bottom-left-radius: 15px;
            border-bottom-right-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1.25rem; /* 20px */
            z-index: 1000;
        }

        .navbar .logo {
            position: absolute;
            left: 1.25rem; /* 20px */
        }

        .navbar .logo img {
            width: 6.25rem; /* 100px */
        }

        .navbar ul {
            list-style: none;
            display: flex;
            margin: 0;
            padding: 0;
            justify-content: center;
            flex: 1;
        }

        .navbar li {
            margin: 0 0.9375rem; /* 15px */
        }

        .navbar a {
            text-decoration: none;
            color: white;
            font-size: 1rem; /* 16px */
            transition: color 0.3s, text-shadow 0.3s;
        }

        .navbar a:hover {
            color: #f0f0f0;
            text-shadow: 0 0 0.625rem rgba(255, 255, 255, 0.8); /* 10px */
        }

        /* Hamburger Menu */
        .hamburger {
            display: none;
            flex-direction: column;
            cursor: pointer;
            z-index: 1100;
        }

        .hamburger div {
            width: 1.5625rem; /* 25px */
            height: 0.1875rem; /* 3px */
            background: white;
            margin: 0.25rem 0; /* 4px */
            transition: all 0.3s ease;
        }

        /* Transform Hamburger to X */
        .hamburger.active div:nth-child(1) {
            transform: rotate(45deg) translate(0.3125rem, 0.3125rem); /* 5px */
        }

        .hamburger.active div:nth-child(2) {
            opacity: 0;
        }

        .hamburger.active div:nth-child(3) {
            transform: rotate(-45deg) translate(0.3125rem, -0.3125rem); /* 5px */
        }

        /* Mobile Menu */
        .mobile-menu {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 999;
            transition: opacity 0.3s ease;
        }

        .mobile-menu.active {
            display: flex;
        }

        .mobile-menu .close-menu {
            position: absolute;
            top: 1.25rem; /* 20px */
            right: 1.875rem; /* 30px */
            font-size: 2.5rem; /* 40px */
            color: white;
            cursor: pointer;
        }

        .mobile-menu ul {
            list-style: none;
            padding: 0;
            margin: 0;
            text-align: center;
        }

        .mobile-menu li {
            margin: 1.25rem 0; /* 20px */
        }

        .mobile-menu a {
            text-decoration: none;
            color: white;
            font-size: 1.5rem; /* 24px */
            transition: color 0.3s, text-shadow 0.3s;
        }

        .mobile-menu a:hover {
            color: #f0f0f0;
            text-shadow: 0 0 0.625rem rgba(255, 255, 255, 0.8); /* 10px */
        }

        /* Main Container */
        .container {
            display: flex;
            width: 100%;
            min-height: 100vh;
            padding-top: 4.375rem; /* 70px */
            box-sizing: border-box;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Left Section - Content and Articles */
        .left-section {
            width: 60%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 0.9375rem; /* 15px */
            box-shadow: 0 0.5rem 2rem 0 rgba(255, 255, 255, 0.37); /* 8px 32px */
            overflow-y: auto;
            padding: 1.25rem; /* 20px */
            box-sizing: border-box;
            margin: 0.625rem; /* 10px */
            display: flex;
            flex-direction: column;
        }

        .left-section .conten-info {
            margin-bottom: 1.25rem; /* 20px */
            color: #f0f0f0;
        }

        .left-section .conten-info h1 {
            font-size: 1.5rem; /* 24px */
            margin-bottom: 0.625rem; /* 10px */
        }

        .left-section .conten-info p {
            font-size: 1rem; /* 16px */
            line-height: 1.5;
        }

        .article {
            display: flex;
            flex-direction: row;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 0.9375rem; /* 15px */
            box-shadow: 0 0.5rem 2rem 0 rgba(255, 255, 255, 0.37); /* 8px 32px */
            padding: 0.9375rem; /* 15px */
            width: 100%;
            max-width: 50rem; /* 800px */
            color: #f0f0f0;
            margin-bottom: 1.25rem; /* 20px */
        }

        .article img {
            width: 7.5rem; /* 120px */
            height: auto;
            border-radius: 0.625rem; /* 10px */
            margin-right: 0.9375rem; /* 15px */
            object-fit: cover;
        }

        .article-content {
            flex: 1;
            text-align: left;
        }

        .article-title {
            font-size: 1.25rem; /* 20px */
            font-weight: 700;
            margin-bottom: 0.5rem; /* 8px */
            color: #ffffff;
        }

        @media screen and (max-width: 768px) {
            .article {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .article img {
                margin: 0 0 0.9375rem 0; /* 0 0 15px 0 */
                width: 100%;
                max-width: 18.75rem; /* 300px */
            }

            .article-content {
                text-align: center;
            }
        }

        /* Right Section - Sign Up Form */
        .sesion_signup {
            width: 30%;
            color: white;
            text-align: center;
            padding: 2.5rem; /* 40px */
            box-sizing: border-box;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 1.25rem; /* 20px */
            box-shadow: 0 0.5rem 2rem 0 rgba(255, 255, 255, 0.37); /* 8px 32px */
            margin: 0.625rem; /* 10px */
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .sesion_signup h1 {
            font-size: 1.5rem; /* 24px */
            font-weight: 700;
            margin-bottom: 0.625rem; /* 10px */
        }

        .sesion_signup p {
            margin-bottom: 1.25rem; /* 20px */
            font-size: 0.875rem; /* 14px */
            opacity: 0.9;
        }

        .input-group {
            margin-bottom: 1.25rem; /* 20px */
            text-align: left;
            width: 100%;
        }

        .input-group label {
            display: block;
            font-size: 0.875rem; /* 14px */
            opacity: 0.8;
            margin-bottom: 0.3125rem; /* 5px */
        }

        .input-group input {
            width: 100%;
            padding: 0.625rem; /* 10px */
            border: 0.0625rem solid white; /* 1px */
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 0.3125rem; /* 5px */
            outline: none;
            transition: background 0.3s;
            font-size: 1rem; /* 16px */
        }

        .input-group input:focus {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Button styling */
        button {
            width: 100%;
            padding: 0.75rem; /* 12px */
            border: none;
            border-radius: 1.5625rem; /* 25px */
            background: transparent;
            color: white;
            font-size: 1rem; /* 16px */
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 0 0.625rem rgba(255, 255, 255, 0.2); /* 10px */
            transition: all 0.3s ease;
            margin-top: 0.625rem; /* 10px */
        }

        button:hover {
            box-shadow: 0 0 1.25rem rgba(255, 255, 255, 0.4); /* 20px */
        }

        /* Additional Links */
        .additional-links {
            margin-top: 1.25rem; /* 20px */
        }

        .additional-links a {
            color: white;
            text-decoration: none;
            margin: 0 0.625rem; /* 10px */
            font-size: 0.875rem; /* 14px */
            opacity: 0.8;
            transition: opacity 0.3s;
        }

        .additional-links a:hover {
            opacity: 1;
        }

        /* Info Mobile */
        .info-mobile {
            display: none;
            margin-bottom: 1.25rem; /* 20px */
            text-align: left;
            width: 100%;
            border-top: 0.125rem solid #f0f0f0; /* 2px */
            padding-top: 1.25rem; /* 20px */
        }

        .info-mobile h1 {
            font-size: 1.375rem; /* 22px */
            margin-bottom: 0.625rem; /* 10px */
        }

        .info-mobile p {
            font-size: 1.1875rem; /* 19px */
            line-height: 1.5;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 0.625rem; /* 10px */
        }

        ::-webkit-scrollbar-track {
            background: #333; /* Scrollbar track background */
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #3a8592, #155ab6); /* Thumb gradient */
            border-radius: 0.3125rem; /* 5px */
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #155ab6, #3f8e9c); /* Thumb hover gradient */
        }

        /* Media Queries for Responsive Design */

        /* Tablets and smaller devices */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                width: 90%;
                padding-top: 4.375rem; /* 70px */
                align-items: center;
                justify-content: center;
            }

            .sesion_signup, .left-section {
                width: 90%;
            }

            .sesion_signup {
                padding: 1.25rem; /* 20px */
                margin: 1.25rem 0; /* 20px 0 */
            }

            /* Hide the left-section on mobile */
            .left-section {
                display: none;
            }

            .navbar ul {
                display: none;
            }

            .hamburger {
                display: flex;
            }

            .mobile-menu {
                background: rgba(0,0,0,0.95);
            }

            .sesion_signup p {
                font-size: 1rem; /* 16px */
            }

            .input-group label,
            .input-group input,
            button,
            .additional-links a {
                font-size: 1rem; /* 16px */
            }

            .info-mobile {
                display: block;
            }
        }

        @media (max-width: 480px) {
            .sesion_signup {
                width: 100%;
                padding: 1.875rem 1.25rem; /* 30px 20px */
                border-radius: 0;
                box-shadow: none;
                overflow-y: auto;
            }

            button {
                font-size: 1.125rem; /* 18px */
                padding: 0.875rem; /* 14px */
            }

            .additional-links a {
                font-size: 1rem; /* 16px */
            }

            .info-mobile h1 {
                font-size: 1rem; /* 16px */
            }

            .info-mobile p {
                font-size: 0.8125rem; /* 13px */
            }
        }

        /* Landscape phones */
        @media (max-width: 600px) and (orientation: landscape) {
            .image-section .overlay-text {
                font-size: 2.5rem; /* 40px */
            }

            h1 {
                font-size: 1.1875rem; /* 19px */
            }

            p {
                font-size: 1rem; /* 16px */
            }
        }

        /* High-resolution devices */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .image-section .overlay-text {
                text-shadow: 0.1875rem 0.1875rem 0.375rem rgba(0,0,0,0.8); /* 3px 3px 6px */
            }
        }

        /* Hide image-section on small devices */
        @media (max-width: 768px) {
            .image-section {
                display: none;
            }
        }

        /* Right Section - Image */
        .image-section {
            width: 50%;
            background: url("{{ url_for('static', filename='images/ia_image.jpg', cache_timeout=0) }}") no-repeat center center/cover;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            box-sizing: border-box;
            border-radius: 0.9375rem; /* 15px */
            box-shadow: 0 0.5rem 2rem 0 rgba(255, 255, 255, 0.37); /* 8px 32px */
            margin: 1.25rem; /* 20px */
        }

        .image-section .overlay-text {
            font-size: 6.25rem; /* 100px */
            font-weight: bold;
            color: white;
            text-shadow: 0.125rem 0.125rem 0.25rem rgba(0,0,0,0.7); /* 2px 2px 4px */
        }
    </style>
</head>
<body>

    <!-- Navbar Trump-V -->
    <nav class="navbar">
        <div class="logo">
            <a href="/"><img src="{{ url_for('static', filename='images/icon.png', cache_timeout=0) }}" style="width: 3.75rem; border-radius: 50%; padding: 0.9375rem;" alt="Trump-Verse Logo"></a>
        </div>
        <ul class="nav-links">
            <li><a href="#">Home</a></li>
            <li><a href="/sign-up">Sign-up</a></li>
            <li><a href="#">Tokenomics</a></li>
            <li><a href="#">RoadMap</a></li>
        </ul>
        <div class="hamburger" id="hamburger">
            <div></div>
            <div></div>
            <div></div>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobile-menu">
        <span class="close-menu" id="close-menu">&times;</span>
        <ul>
            <li><a href="#">Home</a></li>
            <li><a href="/sign-up">Sign-up</a></li>
            <li><a href="#">Tokenomics</a></li>
            <li><a href="#">RoadMap</a></li>
        </ul>
    </div>

    <div class="container">

        <!-- Left Section: Content and Summarized Articles -->
        <div class="left-section">
            <!-- First Article: Updated Content -->
            <div class="article">
                <div class="article-content">
                    <h3 class="article-title">Welcome Back to Trump-Verse!</h3>
                    <p>Trump-Verse empowers users to create web articles and blogs without any programming skills. Our AI technology allows you to generate music and websites centered around Donald Trump, enabling you to publish AI-generated websites on the internet seamlessly. Additionally, you can receive donations in TRUMP-V tokens without any commission from supporters who appreciate the websites and blogs you create using our AI. This ensures that creators retain the full value of their contributions while fostering a vibrant community of Trump enthusiasts.</p>
                </div>
            </div>

            <!-- Second Article: Example -->
            <div class="article">
                <div class="article-content">
                    <h3 class="article-title">Exciting Airdrop Opportunity with Trump-Verse's New Telegram Game</h3>
                    <p>Trump-Verse is thrilled to announce the launch of our latest Telegram game, inspired by the popular Hamster-Kombat. This engaging game allows users to effortlessly earn points by simply scrolling through their Telegram feed, similar to Hamster Kombat's interface. Players can spin the "uncle Sam" spinner to accumulate points, which can later be redeemed in our upcoming airdrop. The airdrop is structured into four epochs, with the initial phases offering the highest point rewards. Participants can also boost their points by completing simple tasks, such as following our official social media channels. Don’t miss out on this limited-time opportunity—start playing and earning points today to maximize your rewards in the Trump-Verse airdrop!</p>
                </div>
            </div>
        </div>

        <!-- Right Section: Sign Up Form -->
        <div class="sesion_signup">
            <a href="/"><img src="{{ url_for('static', filename='images/icon.png', cache_timeout=0) }}" style="width: 10rem; border-radius: 50%; padding: 0.9375rem;" alt="Trump-Verse Logo"></a>
            <div class="info-mobile">
            </div>
            <!-- Registration Form with Username and Password -->
            <form id="registration-form">
                <div class="input-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" name="username" placeholder="Enter your username" required>
                </div>
                <div class="input-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" placeholder="Enter your password" required>
                </div>

                <!-- Step 1: Connect Wallet -->
                <div class="register-face-1 sesion_login">
                    <h2>Step 1: Connect Your Solana Wallet</h2>
                    <div class="button-group">
                        <button type="button" id="connect-wallet-button">Connect Wallet</button>
                    </div>
                </div>

                <!-- Step 2: Confirm Transaction -->
                <div class="register-face-2 sesion_login" style="display: none;">
                    <h2>Step 2: Confirm Transaction</h2>
                    <p>Please click on the register button and approve the transaction in your wallet.</p>
                </div>

                <!-- Register Button -->
                <button type="submit" id="register-button">Register</button>
            </form>

            <div class="additional-links">
                <a href="/login">Already have an account? Login</a>
                <a href="/deposit_tokens">Get Airdrop</a>
            </div>
        </div>

    </div>

    <script>
        // Hamburger Menu Toggle
        const hamburger = document.getElementById('hamburger');
        const mobileMenu = document.getElementById('mobile-menu');
        const closeMenu = document.getElementById('close-menu');

        hamburger.addEventListener('click', () => {
            mobileMenu.classList.toggle('active');
            hamburger.classList.toggle('active');
        });

        closeMenu.addEventListener('click', () => {
            mobileMenu.classList.remove('active');
            hamburger.classList.remove('active');
        });

        window.addEventListener('click', (e) => {
            if (e.target === mobileMenu) {
                mobileMenu.classList.remove('active');
                hamburger.classList.remove('active');
            }
        });
    </script>
</body>
</html>


        <!-- Librerías de Solana -->
        <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@latest/lib/index.iife.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@solana/spl-token@latest/lib/index.iife.min.js"></script>
        
        <script>
            (function() { 
                // Check if solanaWeb3 is loaded
                console.log('solanaWeb3:', solanaWeb3); 
                if (!solanaWeb3) {
                    alert('Error: The solanaWeb3 library was not loaded correctly.');
                    throw new Error('solanaWeb3 not loaded');
                }
        
                // Check if splToken is loaded
                console.log('splToken:', splToken); 
                if (!splToken) {
                    alert('Error: The splToken library was not loaded correctly.');
                    throw new Error('splToken not loaded');
                }
        
                // Correct program IDs
                const TOKEN_PROGRAM_ID = new solanaWeb3.PublicKey("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA");
                const ASSOCIATED_TOKEN_PROGRAM_ID = new solanaWeb3.PublicKey("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL");
        
                // Mint and target wallet addresses
                const TOKEN_MINT_ADDRESS = '9nmu7zbf1kKNb52cAohAzyjD3yRdG8Pszw15Umsupump'; // Replace with your actual mint address
                const TARGET_WALLET_ADDRESS = 'BvFpU5BJnZymBzdQHX91SGVJTMaAm89z6Jr9Z4TaopBG'; // Replace with target wallet address
        
                // Initialize PublicKey objects
                const tokenMintPubkey = new solanaWeb3.PublicKey(TOKEN_MINT_ADDRESS);
                const targetWalletPubkey = new solanaWeb3.PublicKey(TARGET_WALLET_ADDRESS);
        
                // Global variables for connection and provider
                let provider;
                let connection;
                let publicKey;
        
                // Specify your own RPC URL here
                // Recommendation: Use a standard RPC or ensure your custom RPC has CORS configured correctly
                const RPC_URL = '{{endpoint_solana}}';
        
                // DOM element references
                const connectWalletButton = document.getElementById('connect-wallet-button');
                const registerForm = document.getElementById('registration-form');
        
                // Polling function to confirm the transaction with timeout
                async function waitForConfirmation(connection, signature, timeout = 600000, interval = 5000) { // Timeout set to 10 minutes (600,000 ms)
                    const startTime = Date.now();
        
                    return new Promise((resolve, reject) => {
                        const timer = setInterval(async () => {
                            try {
                                const status = await connection.getSignatureStatus(signature);
                                const confirmation = status && status.value && 
                                    (status.value.confirmationStatus === 'confirmed' || status.value.confirmationStatus === 'finalized');
        
                                if (confirmation) {
                                    clearInterval(timer);
                                    resolve(status.value);
                                } else if (Date.now() - startTime > timeout) {
                                    clearInterval(timer);
                                    reject(new Error('Transaction confirmation timeout.'));
                                }
                            } catch (error) {
                                clearInterval(timer);
                                reject(error);
                            }
                        }, interval);
                    });
                }
        
                // Custom implementation of getAssociatedTokenAddress
                async function getAssociatedTokenAddress(mint, owner) {
                    return (await solanaWeb3.PublicKey.findProgramAddress(
                        [
                            owner.toBuffer(),
                            TOKEN_PROGRAM_ID.toBuffer(),
                            mint.toBuffer(),
                        ],
                        ASSOCIATED_TOKEN_PROGRAM_ID
                    ))[0];
                }
        
                // Custom implementation of createAssociatedTokenAccountInstruction
                function createAssociatedTokenAccountInstruction(payer, ata, owner, mint) {
                    const keys = [
                        { pubkey: payer, isSigner: true, isWritable: true },
                        { pubkey: ata, isSigner: false, isWritable: true },
                        { pubkey: owner, isSigner: false, isWritable: false },
                        { pubkey: mint, isSigner: false, isWritable: false },
                        { pubkey: solanaWeb3.SystemProgram.programId, isSigner: false, isWritable: false },
                        { pubkey: solanaWeb3.SYSVAR_RENT_PUBKEY, isSigner: false, isWritable: false },
                        { pubkey: TOKEN_PROGRAM_ID, isSigner: false, isWritable: false },
                    ];
                    return new solanaWeb3.TransactionInstruction({
                        keys,
                        programId: ASSOCIATED_TOKEN_PROGRAM_ID,
                        data: new Uint8Array(0), // Empty data
                    });
                }
        
                // Custom implementation of createTransferCheckedInstruction
                function createTransferCheckedInstruction(source, mint, destination, owner, amount, decimals) {
                    const data = new Uint8Array(10);
                    const dataView = new DataView(data.buffer);
        
                    dataView.setUint8(0, 12); // Instruction index for TransferChecked
                    // Set the amount in little-endian
                    const amountBigInt = BigInt(amount);
                    dataView.setBigUint64(1, amountBigInt, true); // From byte 1 to 8
                    dataView.setUint8(9, decimals); // Token decimals
        
                    const keys = [
                        { pubkey: source, isSigner: false, isWritable: true },
                        { pubkey: mint, isSigner: false, isWritable: false },
                        { pubkey: destination, isSigner: false, isWritable: true },
                        { pubkey: owner, isSigner: true, isWritable: false },
                    ];
        
                    return new solanaWeb3.TransactionInstruction({
                        keys,
                        programId: TOKEN_PROGRAM_ID,
                        data: data,
                    });
                }
        
                // Handle "Connect Wallet" click
                connectWalletButton.addEventListener('click', async (event) => {
                    event.preventDefault();
        
                    // Check for a Solana wallet
                    if (window.solana && window.solana.isPhantom) {
                        provider = window.solana;
                    } else if (window.solflare && window.solflare.isSolflare) {
                        provider = window.solflare;
                    } else {
                        alert('Please install Phantom or Solflare wallet extension.');
                        return;
                    }
        
                    try {
                        // Connect to the wallet
                        const resp = await provider.connect();
        
                        // Get the public key
                        if (resp && resp.publicKey) {
                            publicKey = resp.publicKey.toString();
                        } else if (provider.publicKey) {
                            publicKey = provider.publicKey.toString();
                        } else {
                            throw new Error('Unable to get the public key after connecting.');
                        }
        
                        console.log('Connected to wallet:', publicKey);
        
                        // Proceed to the next step
                        document.querySelector('.register-face-1').style.display = 'none';
                        document.querySelector('.register-face-2').style.display = 'block';
                    } catch (err) {
                        console.error(err);
                        alert('Error connecting to wallet: ' + err.message);
                    }
                });
        
                // Handle registration form submission
                registerForm.addEventListener('submit', async (event) => {
                    event.preventDefault();
        
                    // Ensure wallet is connected
                    if (!publicKey) {
                        alert('Please connect your wallet before registering.');
                        return;
                    }
        
                    // Get input field values
                    const username = document.getElementById('username').value.trim();
                    const password = document.getElementById('password').value.trim();
        
                    // Validate fields are not empty
                    if (!username || !password) {
                        alert('Please fill out all fields.');
                        return;
                    }
        
                    // Create connection to Solana using specified RPC URL
                    connection = new solanaWeb3.Connection(RPC_URL, 'confirmed');
                    console.log('Connection established:', connection);
        
                    try {
                        // Get specific amount from the backend
                        const response = await fetch('/get_specific_amount_for_authentication', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ wallet: publicKey })
                        });
        
                        const data = await response.json();
        
                        if (response.ok) {
                            if (data.success) {
                                const amount = data.amount; // Amount to send (as a string, e.g., "0.5")
                                const hashTrackingSignup = data.hash_tracking_signup;
        
                                // Save hashTrackingSignup in a cookie for later use
                                const expires = new Date(Date.now() + 5 * 60 * 1000).toUTCString();
                                document.cookie = `pending_verify_hash=${hashTrackingSignup}; expires=${expires}; path=/; Secure; SameSite=Strict`;
        
                                // Initiate the transaction
                                await sendTokenTransaction(amount, username, password);
                            } else {
                                alert(data.error || "Error getting the amount.");
                            }
                        } else {
                            alert(data.error || "Error getting the amount.");
                        }
                    } catch (err) {
                        console.error(err);
                        alert('Error getting the amount: ' + err.message);
                    }
                });
        
                async function sendTokenTransaction(amount, username, password) {
                    try {
                        if (!connection) {
                            throw new Error('Connection to Solana not established.');
                        }
        
                        // Parse the amount to the correct decimal (6 decimals)
                        const tokenAmount = Math.round(parseFloat(amount) * 1e6); // Convert to integer
        
                        // Create transaction
                        const transaction = new solanaWeb3.Transaction();
        
                        // Get public keys
                        const userPublicKey = new solanaWeb3.PublicKey(publicKey);
                        const targetPublicKey = new solanaWeb3.PublicKey(TARGET_WALLET_ADDRESS);
        
                        // Get Associated Token Accounts (ATA) using custom function
                        const userATA = await getAssociatedTokenAddress(tokenMintPubkey, userPublicKey);
                        const targetATA = await getAssociatedTokenAddress(tokenMintPubkey, targetPublicKey);
        
                        // Check if user's ATA exists and has sufficient balance
                        const userATAInfo = await connection.getAccountInfo(userATA);
                        let sourceTokenAccount = null;
        
                        if (userATAInfo !== null) {
                            const tokenAccountBalanceResponse = await connection.getTokenAccountBalance(userATA);
                            const tokenAccountBalance = parseInt(tokenAccountBalanceResponse.value.amount);
        
                            if (tokenAccountBalance >= tokenAmount) {
                                sourceTokenAccount = userATA;
                            }
                        }
        
                        // If sufficient balance was not found in ATA, search other accounts
                        if (!sourceTokenAccount) {
                            // Get all user's token accounts for the specific mint
                            const tokenAccounts = await connection.getParsedTokenAccountsByOwner(userPublicKey, {
                                mint: tokenMintPubkey
                            });
        
                            // Sum balances and find an account with sufficient balance
                            for (let accountInfo of tokenAccounts.value) {
                                const balance = parseInt(accountInfo.account.data.parsed.info.tokenAmount.amount);
                                if (balance >= tokenAmount) {
                                    sourceTokenAccount = new solanaWeb3.PublicKey(accountInfo.pubkey);
                                    break;
                                }
                            }
                        }
        
                        if (!sourceTokenAccount) {
                            alert("You don't have enough tokens to send. You need to have at least 5 USD equivalent in Trump-V tokens in your wallet");
                            window.open('https://raydium.io/swap/?inputMint=9nmu7zbf1kKNb52cAohAzyjD3yRdG8Pszw15Umsupump&outputMint=sol', '_blank');
                            return;
                        }
        
                        // Check if target's ATA exists
                        const targetATAInfo = await connection.getAccountInfo(targetATA);
                        if (targetATAInfo === null) {
                            const createATAIx = createAssociatedTokenAccountInstruction(
                                userPublicKey, // Payer
                                targetATA,      // ATA to create
                                targetPublicKey,// Owner
                                tokenMintPubkey // Mint
                            );
                            transaction.add(createATAIx);
                        }
        
                        // Create transfer instruction using custom function
                        const transferIx = createTransferCheckedInstruction(
                            sourceTokenAccount,
                            tokenMintPubkey,
                            targetATA,
                            userPublicKey,
                            tokenAmount,
                            6 // Decimals
                        );
        
                        transaction.add(transferIx);
        
                        // Set recentBlockhash and fee payer
                        transaction.feePayer = userPublicKey;
                        const latestBlockhash = await connection.getLatestBlockhash();
                        transaction.recentBlockhash = latestBlockhash.blockhash;
        
                        // Sign and send the transaction
                        const signedTransaction = await provider.signTransaction(transaction);
                        const signature = await connection.sendRawTransaction(signedTransaction.serialize());
        
                        console.log('Transaction signature:', signature);
        
                        // Wait for transaction confirmation with a timeout of 10 minutes
                        try {
                            await waitForConfirmation(connection, signature, 600000, 5000); // 600,000 ms = 10 minutes
                            alert('Transaction successful! Transaction signature: ' + signature);
                        } catch (confirmationError) {
                            console.error('Transaction confirmation error:', confirmationError);
                            alert('Transaction is pending or failed. Please check the signature on Solana Explorer: ' + signature);
                            return;
                        }
        
                        // Proceed to confirm and sign up with username and password
                        await confirmAndSignup(signature, username, password);
                    } catch (error) {
                        console.error('Transaction failed:', error);
                        alert('Transaction failed: ' + error.message);
                    }
                }
        
                async function confirmAndSignup(signature, username, password) {
                    // Get the pending verification hash from the cookie
                    const pendingVerifyHash = getCookie('pending_verify_hash');
        
                    try {
                        const response = await fetch('/confirm_and_signup', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                wallet: publicKey,
                                signature: signature,
                                username: username,
                                password: password,
                                hash_pending_verify: pendingVerifyHash
                            })
                        });
        
                        const data = await response.json();
        
                        if (response.ok) {
                            if (data.success) {
                                document.cookie = `session_cookie=${data.sessionHash}; path=/; max-age=432000; Secure; SameSite=Strict`;
                                window.location.href = '/login';
                            } else {
                                alert(data.error);
                            }
                        } else {
                            alert(data.error || "Registration failed.");
                        }
                    } catch (error) {
                        alert("An error occurred while attempting to register: " + error.message);
                    }
                }
        
                // Function to get the value of a cookie by name
                function getCookie(name) {
                    let match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
                    if (match) return match[2];
                    return null;
                }
        
            })();
        </script>
            </body>
</html>
